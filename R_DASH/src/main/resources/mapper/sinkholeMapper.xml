<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pcwk.ehr.mapper.SinkholeMapper">

  <select id="selectAll" resultType="com.pcwk.ehr.domain.SinkholeDTO">
    SELECT SINKHOLE_NO AS sinkholeNo, SIDO_NM AS sidoNm, SIGNGU_NM AS signguNm,
           LAT, LON, TO_CHAR(OCCUR_DT,'YYYY-MM-DD') AS occurDt, STATE_NM AS stateNm
    FROM SINKHOLE
    ORDER BY OCCUR_DT DESC, SINKHOLE_NO DESC
  </select>

  <select id="selectByBBox" resultType="com.pcwk.ehr.domain.SinkholeDTO">
    SELECT SINKHOLE_NO AS sinkholeNo, SIDO_NM AS sidoNm, SIGNGU_NM AS signguNm,
           LAT, LON, TO_CHAR(OCCUR_DT,'YYYY-MM-DD') AS occurDt, STATE_NM AS stateNm
    FROM SINKHOLE
    WHERE LAT BETWEEN #{minLat} AND #{maxLat}
      AND LON BETWEEN #{minLon} AND #{maxLon}
    ORDER BY OCCUR_DT DESC, SINKHOLE_NO DESC
  </select>

  <select id="findById" resultType="com.pcwk.ehr.domain.SinkholeDTO">
    SELECT SINKHOLE_NO AS sinkholeNo, SIDO_NM AS sidoNm, SIGNGU_NM AS signguNm,
           LAT, LON, TO_CHAR(OCCUR_DT,'YYYY-MM-DD') AS occurDt, STATE_NM AS stateNm
    FROM SINKHOLE
    WHERE SINKHOLE_NO = #{sinkholeNo}
  </select>

  <select id="countByState" resultType="map">
    SELECT NVL(STATE_NM, 'UNKNOWN') AS STATE_NM,
           COUNT(*)                 AS CNT
    FROM SINKHOLE
    GROUP BY STATE_NM
    ORDER BY CNT DESC
  </select>

</mapper>
